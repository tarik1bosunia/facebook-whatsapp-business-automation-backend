# PostgreSQL Setup

# go to https://www.postgresql.org/download/windows and download pgsql 

# add to path(System Variables)
```
C:\Program Files\PostgreSQL\17\bin
```

## in settings.py

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'fbadb',  # Matches POSTGRES_DB
        'USER': 'postgres',  # Matches POSTGRES_USER
        'PASSWORD': os.getenv('DB_PASSWORD', 'my_secret_password'),  # Load from env variable or leave as an empty string
        'HOST': 'db',  # Docker service name
        'PORT': '5432',  # PostgreSQL default port
    }
}
```

## Ubuntu Commands
```sh
sudo su - postgres
psql
```

### Install PostgreSQL Driver for Python
```sh
pip install psycopg2
```

### Create Database and Connect
```sql
CREATE DATABASE ratemyprofessorsdb;
\l -- List all databases
\c ratemyprofessorsdb -- Connect to the new database
```

### Create User and Schema
```sql
CREATE USER tata WITH PASSWORD '11235813'; --Creates a new user tata
CREATE SCHEMA ratemyprofessorsdbschema AUTHORIZATION tata; --Creates a schema named ratemyprofessorsdbschema owned by tata
```
### Set Defaults for User
```sql

ALTER ROLE tata SET default_transaction_isolation TO 'read committed';
ALTER ROLE tata SET timezone TO 'UTC';
```
### List Tables (optional, no tables exist yet)
```sql
\dt
```
### To set schema search path per user, use:
```sql
ALTER ROLE tata SET search_path = ratemyprofessorsdbschema;
```
### Or to set it only for this database, log in to ratemyprofessorsdb and run:
```
ALTER DATABASE ratemyprofessorsdb SET search_path = ratemyprofessorsdbschema;
```
### error: psycopg2.errors.InsufficientPrivilege: permission denied for schema public
```sql
GRANT ALL PRIVILEGES ON SCHEMA public TO tata;
```

# 
```sh
GRANT ALL PRIVILEGES ON DATABASE ratemyprofessorsdb TO tata
``
---
###  for the error: psycopg2.errors.DuplicateTable: relation "messaging_conversation_user_id_cc331899" already exists
```shell
python manage.py migrate messaging --fake 
python manage.py migrate
```


# Create PostgreSQL Database
-  psql: Command-line interface for PostgreSQL.
- -U postgres: Login as the PostgreSQL superuser postgres.

```sh
psql -U postgres
```
# Create Database and User
```sh
CREATE DATABASE mydatabase;
CREATE USER myuser WITH PASSWORD 'mypassword';
ALTER ROLE myuser SET client_encoding TO 'utf8';
ALTER ROLE myuser SET default_transaction_isolation TO 'read committed';
ALTER ROLE myuser SET timezone TO 'UTC';
GRANT ALL PRIVILEGES ON DATABASE mydatabase TO myuser;
```

- CREATE DATABASE: Command to create a new database.
- CREATE USER: Command to create a new database user.
- ALTER ROLE: Commands to set client encoding, transaction isolation, and timezone for the user.
- GRANT ALL PRIVILEGES: Grant all privileges to the user on the created database.


CREATE SCHEMA fbadbschema AUTHORIZATION tata;
fbadb=> ALTER ROLE tata SET search_path = fbadbschema,public;